<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">

    <title>Bookstore</title>

    <link rel="stylesheet" href="">
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Bootstrap libraries -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css'
        rel='stylesheet'
        integrity='sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC'
        crossorigin='anonymous'>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body>
    <h1>Book Search</h1>
    <form id="isbnForm">
        <input name="isbn13" type="text" id="isbn13" class="form-control" placeholder="ISBN Number"
            required autofocus>
        <input type="submit">
    </form>

    <div id="results">
        <table id="booksTable" class='table table-striped border-1' id='book-list' >
            <thead class='border-1'>
                <th>Title</th>
                <th>ISBN 13</th>
                <th>Price</th>
                <th>Availability</th>
            </thead>
        </table>
    </div>
    <label id="error" class="text-danger"></label>
    <script>
        // Helper function to display error message
        function showError(message) {
            // Display an error under the the predefined label with error as the id
            $("#results").hide();
            $('#error').text(message);
            $('#error').show();
        }

        $(function () {
            $("#results").hide();

            //This is considered an event call
            //It listens to the isbnForm <form id="isbnForm">
            //When submitted button is clicked it perform a series of actions through a function
            $("#isbnForm").submit(async (event) => {
                //Prevents screen from refreshing when submitting as we are not going to another page
                event.preventDefault();

                $("#error").hide();

                //Get ISBN Number from the form
                var isbnNumber = $('#isbn13').val()
                var serviceURL = "http://127.0.0.1:5000/book/" + isbnNumber;

                try {
                    const response =
                        await fetch(
                            serviceURL, { method: 'GET' }
                        );
                    const data = await response.json();
                    book = data.data;     // the actual data is within another data element of the retrieved data 

                    if (response.ok) {
                        foundBook =
                            "<tbody>" +
                            "<tr>" +
                            "<td>" + book.title + "</td>" +
                            "<td>" + book.isbn13 + "</td>" +
                            "<td>" + book.price + "</td>" +
                            "<td>" + book.availability + "</td>" +
                            "</tr>" +
                            "<tbody>";
                        // $('#message').hide();
                        $("#results").show();
                        $('#booksTable tbody').empty();
                        $('#booksTable').append(foundBook);
                    } else {
                        showError(data.message);
                    }

                } catch (error) {
                    // Errors when calling the service; such as network error, 
                    // service offline, etc
                    showError
                        ('There is a problem retrieving books data, please try again later.<br />' + error);

                }
            })
        });
    </script>

    <!-- Bootstrap Javascript -->
    <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js'
        integrity='sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM'
        crossorigin='anonymous'></script>

</body>

</html>